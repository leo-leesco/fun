<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.20.1: https://docutils.sourceforge.io/" />
<title>LambdaCalculusReduction.v</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-windowed"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.13.0+0.13.1. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><div class="document">


<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> MyTactics.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Sequences.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> LambdaCalculusSyntax.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> LambdaCalculusValues.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> LambdaCalculusFreeVars.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* We give a symbolic name to each reduction rule. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">rule</span> :=
| RuleBetaV    <span class="c">(* reduction of a beta-v redex: (\x.t) v                   *)</span>
| RuleLetV     <span class="c">(* reduction of a let-v redex:  let x = v in t             *)</span>
| RuleBeta     <span class="c">(* reduction of a beta   redex: (\x.t) u                   *)</span>
| RuleLet      <span class="c">(* reduction of a let redex:    let x = u in t             *)</span>
| RuleParBetaV <span class="c">(* reduction of a beta-v redex and reduction in both sides *)</span>
| RuleParLetV  <span class="c">(* reduction of a let redex and reduction in both sides    *)</span>
| RuleVar      <span class="c">(* no reduction                                            *)</span>
| RuleLam      <span class="c">(* reduction in [Lam _]                                    *)</span>
| RuleAppL     <span class="c">(* reduction in [App _ u]                                  *)</span>
| RuleAppVR    <span class="c">(* reduction in [App v _], if [v] is a value               *)</span>
| RuleAppLR    <span class="c">(* reduction in both sides of [App _ _]                    *)</span>
| RuleLetL     <span class="c">(* reduction in [Let _ u]                                  *)</span>
| RuleLetR     <span class="c">(* reduction in [Let t _]                                  *)</span>
| RuleLetLR    <span class="c">(* reduction in both sides of [Let _ _]                    *)</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* A mask is a set of rules. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">mask</span> :=
  rule -&gt; <span class="kt">Prop</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* A generic small-step reduction semantics, parameterized with a mask. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">red</span> (<span class="nv">mask</span> : mask) : term -&gt; term -&gt; <span class="kt">Prop</span> :=
| RedBetaV:
    <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span>,
    mask RuleBetaV -&gt;
    is_value v -&gt;
    t.[v/] = u -&gt;
    <span class="nb">red</span> mask (App (Lam t) v) u
| RedLetV:
    <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span>,
    mask RuleLetV -&gt;
    is_value v -&gt;
    t.[v/] = u -&gt;
    <span class="nb">red</span> mask (<span class="kn">Let</span> <span class="nf">v</span> <span class="nv">t</span>) u
| RedBeta:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
    mask RuleBeta -&gt;
    t1.[t2/] = u -&gt;
    <span class="nb">red</span> mask (App (Lam t1) t2) u
| RedLet:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
    mask RuleLet -&gt;
    t2.[t1/] = u -&gt;
    <span class="nb">red</span> mask (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>) u
| RedParBetaV:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">v1</span> <span class="nv">t2</span> <span class="nv">v2</span> <span class="nv">u</span>,
    mask RuleParBetaV -&gt;
    is_value v1 -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask v1 v2 -&gt;
    t2.[v2/] = u -&gt;
    <span class="nb">red</span> mask (App (Lam t1) v1) u
| RedParLetV:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">v1</span> <span class="nv">v2</span> <span class="nv">u</span>,
    mask RuleParLetV -&gt;
    is_value v1 -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask v1 v2 -&gt;
    t2.[v2/] = u -&gt;
    <span class="nb">red</span> mask (<span class="kn">Let</span> <span class="nf">v1</span> <span class="nv">t1</span>) u
| RedVar:
    <span class="kr">forall</span> <span class="nv">x</span>,
    mask RuleVar -&gt;
    <span class="nb">red</span> mask (Var x) (Var x)
| RedLam:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span>,
    mask RuleLam -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask (Lam t1) (Lam t2)
| RedAppL:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
    mask RuleAppL -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask (App t1 u) (App t2 u)
| RedAppVR:
    <span class="kr">forall</span> <span class="nv">v</span> <span class="nv">u1</span> <span class="nv">u2</span>,
    mask RuleAppVR -&gt;
    is_value v -&gt;
    <span class="nb">red</span> mask u1 u2 -&gt;
    <span class="nb">red</span> mask (App v u1) (App v u2)
| RedAppLR:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u1</span> <span class="nv">u2</span>,
    mask RuleAppLR -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask u1 u2 -&gt;
    <span class="nb">red</span> mask (App t1 u1) (App t2 u2)
| RedLetL:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
    mask RuleLetL -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">u</span>) (<span class="kn">Let</span> <span class="nf">t2</span> <span class="nv">u</span>)
| RedLetR:
    <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u1</span> <span class="nv">u2</span>,
    mask RuleLetR -&gt;
    <span class="nb">red</span> mask u1 u2 -&gt;
    <span class="nb">red</span> mask (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u1</span>) (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u2</span>)
| RedLetLR:
    <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u1</span> <span class="nv">u2</span>,
    mask RuleLetLR -&gt;
    <span class="nb">red</span> mask t1 t2 -&gt;
    <span class="nb">red</span> mask u1 u2 -&gt;
    <span class="nb">red</span> mask (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">u1</span>) (<span class="kn">Let</span> <span class="nf">t2</span> <span class="nv">u2</span>)
.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Constructors</span> <span class="nb">red</span> : <span class="nb">red</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The following mask defines the call-by-value reduction semantics. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">cbv_mask</span> <span class="nv">rule</span> :=
  <span class="kr">match</span> rule <span class="kr">with</span>
  | RuleBetaV    <span class="c">(* reduction of a beta-v redex: (\x.t) v                 *)</span>
  | RuleLetV     <span class="c">(* reduction of a let-v redex:  let x = v in t           *)</span>
  | RuleAppL     <span class="c">(* reduction in [App _ u]                                *)</span>
  | RuleAppVR    <span class="c">(* reduction in [App v _], if [v] is a value             *)</span>
  | RuleLetL     <span class="c">(* reduction in [Let _ u]                                *)</span>
      =&gt; <span class="kt">True</span>
  | _ =&gt; <span class="kt">False</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="nf">cbv</span> := (<span class="nb">red</span> cbv_mask).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The following mask defines the call-by-name reduction semantics. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">cbn_mask</span> <span class="nv">rule</span> :=
  <span class="kr">match</span> rule <span class="kr">with</span>
  | RuleBeta     <span class="c">(* reduction of a beta   redex: (\x.t) v                 *)</span>
  | RuleLet      <span class="c">(* reduction of a let redex:    let x = v in t           *)</span>
  | RuleAppL     <span class="c">(* reduction in [App _ u]                                *)</span>
      =&gt; <span class="kt">True</span>
  | _ =&gt; <span class="kt">False</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="nf">cbn</span> := (<span class="nb">red</span> cbn_mask).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The parallel by-value reduction semantics allows beta-v reductions under</span>
<span class="c">   arbitrary contexts, including under lambda-abstractions. Furthermore, it</span>
<span class="c">   allows parallel reductions (and allows no reduction at all). *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">pcbv_mask</span> <span class="nv">rule</span> :=
  <span class="kr">match</span> rule <span class="kr">with</span>
  | RuleParBetaV <span class="c">(* reduction of a beta redex and reduction in both sides *)</span>
  | RuleParLetV  <span class="c">(* reduction of a let redex and reduction in both sides  *)</span>
  | RuleVar      <span class="c">(* no reduction                                          *)</span>
  | RuleLam      <span class="c">(* reduction in [Lam _]                                  *)</span>
  | RuleAppLR    <span class="c">(* reduction in both sides of [App _ _]                  *)</span>
  | RuleLetLR    <span class="c">(* reduction in both sides of [Let _ _]                  *)</span>
      =&gt; <span class="kt">True</span>
  | _ =&gt; <span class="kt">False</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="nf">pcbv</span> := (<span class="nb">red</span> pcbv_mask).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The tactic [obvious] should be able to prove goals of the form</span>
<span class="c">   [red mask t1 t2], where [mask] is a known mask. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Extern</span> <span class="mi">1</span> (cbv_mask _)  =&gt; (<span class="nb">simpl</span>; <span class="bp">tauto</span>) : <span class="nb">red</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Extern</span> <span class="mi">1</span> (cbn_mask _)  =&gt; (<span class="nb">simpl</span>; <span class="bp">tauto</span>) : <span class="nb">red</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Extern</span> <span class="mi">1</span> (pcbv_mask _) =&gt; (<span class="nb">simpl</span>; <span class="bp">tauto</span>) : <span class="nb">red</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk0"><span class="kn">Goal</span> <span class="nb">cbv</span> (<span class="kn">Let</span> (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)) (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbv</span> (<span class="kn">Let</span> (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>))
  (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbv</span> (<span class="kn">Let</span> (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>))
  (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2"><span class="kn">Goal</span> <span class="nb">cbv</span> (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbv</span> (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbv</span> (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk4"><span class="kn">Goal</span> <span class="nb">cbn</span> (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbn</span> (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk5"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbn</span> (<span class="kn">Let</span> (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6"><span class="kn">Goal</span>
  <span class="kr">let</span> <span class="nv">id</span> := Lam (Var <span class="mi">0</span>) <span class="kr">in</span>
  <span class="kr">let</span> <span class="nv">t</span> := (<span class="kn">Let</span> (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)) <span class="kr">in</span>
  <span class="nb">cbn</span> (App id t) t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">let</span> <span class="nv">id</span> := Lam (Var <span class="mi">0</span>) <span class="kr">in</span>
<span class="kr">let</span> <span class="nv">t</span> := <span class="kn">Let</span> (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>) <span class="kr">in</span> <span class="nb">cbn</span> (App id t) t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">let</span> <span class="nv">id</span> := Lam (Var <span class="mi">0</span>) <span class="kr">in</span>
<span class="kr">let</span> <span class="nv">t</span> := <span class="kn">Let</span> (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>) <span class="kr">in</span> <span class="nb">cbn</span> (App id t) t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk8"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbn</span> (App (Lam (Var <span class="mi">0</span>)) (<span class="kn">Let</span> (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)))
  (<span class="kn">Let</span> (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk9"><span class="kn">Goal</span> pcbv (App (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)) (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)))
          (App (Var <span class="mi">0</span>) (Var <span class="mi">0</span>)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">pcbv
  (App (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>))
     (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)))
  (App (Var <span class="mi">0</span>) (Var <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chka"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">pcbv
  (App (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>))
     (App (Lam (Var <span class="mi">0</span>)) (Var <span class="mi">0</span>)))
  (App (Var <span class="mi">0</span>) (Var <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto</span> <span class="mi">8</span> <span class="kr">with</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The tactic [step] applies to a goal of the form [star (red mask) t1 t2]. It</span>
<span class="c">   causes the term [t1] to take one step of reduction towards [t1&#39;], turning</span>
<span class="c">   the goal into [star (red mask) t1&#39; t2]. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">step</span> :=
  <span class="nb">eapply</span> star_step; [ obvious |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The tactic [finished] applies to a goal of the form [star (red mask) t1 t2].</span>
<span class="c">   It turns the goal into [t1 = t2]. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">finished</span> :=
  <span class="nb">eapply</span> star_refl_eq.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The tactic [invert_cbv] inverts a hypothesis of the form [cbv t1 t2]. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">invert_cbv</span> :=
  pick (<span class="nb">red</span> cbv_mask) invert;
  <span class="kp">try</span> <span class="kp">solve</span> [ false; <span class="nb">eauto</span> <span class="mi">3</span> <span class="kr">with</span> obvious ].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">invert_star_cbv</span> :=
  pick (star <span class="nb">cbv</span>) invert.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">invert_cbn</span> :=
  pick (<span class="nb">red</span> cbn_mask) invert;
  <span class="kp">try</span> <span class="kp">solve</span> [ false; <span class="nb">eauto</span> <span class="mi">3</span> <span class="kr">with</span> obvious ].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* If the following four rules are enabled, then reduction is reflexive. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chkb"><span class="kn">Lemma</span> <span class="nf">red_refl</span>:
  <span class="kr">forall</span> <span class="nv">mask</span> : mask,
  mask RuleVar -&gt;
  mask RuleLam -&gt;
  mask RuleAppLR -&gt;
  mask RuleLetLR -&gt;
  <span class="kr">forall</span> <span class="nv">t</span>,
  <span class="nb">red</span> mask t t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">mask</span> : mask,
mask RuleVar -&gt;
mask RuleLam -&gt;
mask RuleAppLR -&gt;
mask RuleLetLR -&gt; <span class="kr">forall</span> <span class="nv">t</span> : term, <span class="nb">red</span> mask t t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chkc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">mask</span> : mask,
mask RuleVar -&gt;
mask RuleLam -&gt;
mask RuleAppLR -&gt;
mask RuleLetLR -&gt; <span class="kr">forall</span> <span class="nv">t</span> : term, <span class="nb">red</span> mask t t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> t; <span class="nb">eauto with</span> <span class="nb">red</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* [RuleBetaV] and [RuleLetV] are special cases of [RuleParBetaV] and</span>
<span class="c">   [RuleParLetV], hence are admissible in parallel call-by-value reduction. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chkd"><span class="kn">Lemma</span> <span class="nf">pcbv_RedBetaV</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span>,
  is_value v -&gt;
  t.[v/] = u -&gt;
  pcbv (App (Lam t) v) u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span> : term,
is_value v -&gt; t.[v/] = u -&gt; pcbv (App (Lam t) v) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chke"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span> : term,
is_value v -&gt; t.[v/] = u -&gt; pcbv (App (Lam t) v) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto using</span> red_refl <span class="kr">with</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chkf"><span class="kn">Lemma</span> <span class="nf">pcbv_RedLetV</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span>,
  is_value v -&gt;
  t.[v/] = u -&gt;
  pcbv (<span class="kn">Let</span> <span class="nf">v</span> <span class="nv">t</span>) u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span> : term,
is_value v -&gt; t.[v/] = u -&gt; pcbv (<span class="kn">Let</span> <span class="nf">v</span> <span class="nv">t</span>) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk10"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">v</span> <span class="nv">u</span> : term,
is_value v -&gt; t.[v/] = u -&gt; pcbv (<span class="kn">Let</span> <span class="nf">v</span> <span class="nv">t</span>) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto using</span> red_refl <span class="kr">with</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Sequences of reduction, [star cbv], can be carried out under a context. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk11"><span class="kn">Lemma</span> <span class="nf">star_cbv_AppL</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
  star <span class="nb">cbv</span> t1 t2 -&gt;
  star <span class="nb">cbv</span> (App t1 u) (App t2 u).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span> : term,
star <span class="nb">cbv</span> t1 t2 -&gt; star <span class="nb">cbv</span> (App t1 u) (App t2 u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk12"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span> : term,
star <span class="nb">cbv</span> t1 t2 -&gt; star <span class="nb">cbv</span> (App t1 u) (App t2 u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; <span class="nb">eauto with</span> sequences obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk13"><span class="kn">Lemma</span> <span class="nf">star_pcbv_AppL</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
  star pcbv t1 t2 -&gt;
  star pcbv (App t1 u) (App t2 u).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span> : term,
star pcbv t1 t2 -&gt; star pcbv (App t1 u) (App t2 u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk14"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span> : term,
star pcbv t1 t2 -&gt; star pcbv (App t1 u) (App t2 u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; <span class="nb">eauto using</span> red_refl <span class="kr">with</span> sequences obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk15"><span class="kn">Lemma</span> <span class="nf">plus_pcbv_AppL</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
  plus pcbv t1 t2 -&gt;
  plus pcbv (App t1 u) (App t2 u).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span> : term,
plus pcbv t1 t2 -&gt; plus pcbv (App t1 u) (App t2 u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk16"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span> : term,
plus pcbv t1 t2 -&gt; plus pcbv (App t1 u) (App t2 u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk17"><span class="nb">induction</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>u, a, b, c</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>pcbv a b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>star pcbv b c</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">plus pcbv (App a u) (App c u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk18"><span class="nb">econstructor</span>; [ | <span class="nb">eauto using</span> star_pcbv_AppL ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>u, a, b, c</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>pcbv a b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>star pcbv b c</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pcbv (App a u) (App b u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eapply</span> RedAppLR; <span class="nb">eauto using</span> red_refl <span class="kr">with</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk19"><span class="kn">Lemma</span> <span class="nf">star_cbv_AppR</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u1</span> <span class="nv">u2</span>,
  is_value t -&gt;
  star <span class="nb">cbv</span> u1 u2 -&gt;
  star <span class="nb">cbv</span> (App t u1) (App t u2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u1</span> <span class="nv">u2</span> : term,
is_value t -&gt;
star <span class="nb">cbv</span> u1 u2 -&gt; star <span class="nb">cbv</span> (App t u1) (App t u2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u1</span> <span class="nv">u2</span> : term,
is_value t -&gt;
star <span class="nb">cbv</span> u1 u2 -&gt; star <span class="nb">cbv</span> (App t u1) (App t u2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">2</span>; <span class="nb">eauto with</span> sequences obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span> star_cbv_AppL star_pcbv_AppL plus_pcbv_AppL star_cbv_AppR : <span class="nb">red</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1b"><span class="kn">Lemma</span> <span class="nf">star_cbv_AppLR</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u1</span> <span class="nv">u2</span>,
  star <span class="nb">cbv</span> t1 t2 -&gt;
  star <span class="nb">cbv</span> u1 u2 -&gt;
  is_value t2 -&gt;
  star <span class="nb">cbv</span> (App t1 u1) (App t2 u2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u1</span> <span class="nv">u2</span> : term,
star <span class="nb">cbv</span> t1 t2 -&gt;
star <span class="nb">cbv</span> u1 u2 -&gt;
is_value t2 -&gt; star <span class="nb">cbv</span> (App t1 u1) (App t2 u2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u1</span> <span class="nv">u2</span> : term,
star <span class="nb">cbv</span> t1 t2 -&gt;
star <span class="nb">cbv</span> u1 u2 -&gt;
is_value t2 -&gt; star <span class="nb">cbv</span> (App t1 u1) (App t2 u2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto with</span> sequences obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1d"><span class="kn">Lemma</span> <span class="nf">star_cbv_LetL</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">u</span>,
  star <span class="nb">cbv</span> t1 t2 -&gt;
  star <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">u</span>) (<span class="kn">Let</span> <span class="nf">t2</span> <span class="nv">u</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">t1</span> <span class="nv">t2</span> : term) (<span class="nv">u</span> : {bind term}),
star <span class="nb">cbv</span> t1 t2 -&gt; star <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">u</span>) (<span class="kn">Let</span> <span class="nf">t2</span> <span class="nv">u</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">t1</span> <span class="nv">t2</span> : term) (<span class="nv">u</span> : {bind term}),
star <span class="nb">cbv</span> t1 t2 -&gt; star <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">u</span>) (<span class="kn">Let</span> <span class="nf">t2</span> <span class="nv">u</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; <span class="nb">eauto with</span> sequences obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span> star_cbv_AppLR star_cbv_LetL : <span class="nb">red</span> obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Reduction commutes with substitutions of values for variables. (This</span>
<span class="c">   includes renamings.) This is true of every reduction strategy, with</span>
<span class="c">   the proviso that if [RuleVar] is enabled, then [RuleLam], [RuleAppLR]</span>
<span class="c">   and [RuleLetLR] must be enabled as well, so that reduction is reflexive. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk1f"><span class="kn">Lemma</span> <span class="nf">red_subst</span>:
  <span class="kr">forall</span> <span class="nv">mask</span> : mask,
  (mask RuleVar -&gt; mask RuleLam) -&gt;
  (mask RuleVar -&gt; mask RuleAppLR) -&gt;
  (mask RuleVar -&gt; mask RuleLetLR) -&gt;
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span>,
  <span class="nb">red</span> mask t1 t2 -&gt;
  <span class="kr">forall</span> <span class="nv">sigma</span>,
  is_value_subst sigma -&gt;
  <span class="nb">red</span> mask t1.[sigma] t2.[sigma].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">mask</span> : mask,
(mask RuleVar -&gt; mask RuleLam) -&gt;
(mask RuleVar -&gt; mask RuleAppLR) -&gt;
(mask RuleVar -&gt; mask RuleLetLR) -&gt;
<span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> : term,
<span class="nb">red</span> mask t1 t2 -&gt;
<span class="kr">forall</span> <span class="nv">sigma</span> : var -&gt; term,
is_value_subst sigma -&gt; <span class="nb">red</span> mask t1.[sigma] t2.[sigma]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk20"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">mask</span> : mask,
(mask RuleVar -&gt; mask RuleLam) -&gt;
(mask RuleVar -&gt; mask RuleAppLR) -&gt;
(mask RuleVar -&gt; mask RuleLetLR) -&gt;
<span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> : term,
<span class="nb">red</span> mask t1 t2 -&gt;
<span class="kr">forall</span> <span class="nv">sigma</span> : var -&gt; term,
is_value_subst sigma -&gt; <span class="nb">red</span> mask t1.[sigma] t2.[sigma]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk21"><span class="nb">induction</span> <span class="mi">4</span>; <span class="nb">simpl</span>; <span class="nb">intros</span>; <span class="nb">subst</span>;
  <span class="kp">try</span> <span class="kp">solve</span> [ <span class="nb">econstructor</span>; <span class="kp">solve</span> [ <span class="nb">eauto with</span> is_value | autosubst ]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>mask0</var><span class="hyp-type"><b>: </b><span>mask</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar -&gt; mask0 RuleLam</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar -&gt; mask0 RuleAppLR</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar -&gt; mask0 RuleLetLR</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>var</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar</span></span></span><br><span><var>sigma</var><span class="hyp-type"><b>: </b><span>var -&gt; term</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>is_value_subst sigma</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">red</span> mask0 (sigma x) (sigma x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* Case: [Var] *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk22">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>mask0</var><span class="hyp-type"><b>: </b><span>mask</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar -&gt; mask0 RuleLam</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar -&gt; mask0 RuleAppLR</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar -&gt; mask0 RuleLetLR</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>var</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>mask0 RuleVar</span></span></span><br><span><var>sigma</var><span class="hyp-type"><b>: </b><span>var -&gt; term</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>is_value_subst sigma</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">red</span> mask0 (sigma x) (sigma x)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto using</span> red_refl.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk23"><span class="kn">Lemma</span> <span class="nf">star_red_subst</span>:
  <span class="kr">forall</span> <span class="nv">mask</span> : mask,
  (mask RuleVar -&gt; mask RuleLam) -&gt;
  (mask RuleVar -&gt; mask RuleAppLR) -&gt;
  (mask RuleVar -&gt; mask RuleLetLR) -&gt;
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> <span class="nv">sigma</span>,
  star (<span class="nb">red</span> mask) t1 t2 -&gt;
  is_value_subst sigma -&gt;
  star (<span class="nb">red</span> mask) t1.[sigma] t2.[sigma].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">mask</span> : mask,
(mask RuleVar -&gt; mask RuleLam) -&gt;
(mask RuleVar -&gt; mask RuleAppLR) -&gt;
(mask RuleVar -&gt; mask RuleLetLR) -&gt;
<span class="kr">forall</span> (<span class="nv">t1</span> <span class="nv">t2</span> : term) (<span class="nv">sigma</span> : var -&gt; term),
star (<span class="nb">red</span> mask) t1 t2 -&gt;
is_value_subst sigma -&gt;
star (<span class="nb">red</span> mask) t1.[sigma] t2.[sigma]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk24"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">mask</span> : mask,
(mask RuleVar -&gt; mask RuleLam) -&gt;
(mask RuleVar -&gt; mask RuleAppLR) -&gt;
(mask RuleVar -&gt; mask RuleLetLR) -&gt;
<span class="kr">forall</span> (<span class="nv">t1</span> <span class="nv">t2</span> : term) (<span class="nv">sigma</span> : var -&gt; term),
star (<span class="nb">red</span> mask) t1 t2 -&gt;
is_value_subst sigma -&gt;
star (<span class="nb">red</span> mask) t1.[sigma] t2.[sigma]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">4</span>; <span class="nb">eauto using</span> red_subst <span class="kr">with</span> sequences.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Call-by-value reduction is contained in parallel call-by-value. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk25"><span class="kn">Lemma</span> <span class="nf">cbv_subset_pcbv</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span>,
  <span class="nb">cbv</span> t1 t2 -&gt;
  pcbv t1 t2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> : term, <span class="nb">cbv</span> t1 t2 -&gt; pcbv t1 t2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk26"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> : term, <span class="nb">cbv</span> t1 t2 -&gt; pcbv t1 t2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; <span class="kp">try</span> <span class="kp">solve</span> [ <span class="bp">tauto</span> ]; <span class="nb">eauto using</span> red_refl <span class="kr">with</span> <span class="nb">red</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Under call-by-value, values do not reduce. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk27"><span class="kn">Lemma</span> <span class="nf">values_do_not_reduce</span>:
  <span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span>,
  <span class="nb">cbv</span> t1 t2 -&gt;
  ~ is_value t1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> : term, <span class="nb">cbv</span> t1 t2 -&gt; ~ is_value t1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk28"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t1</span> <span class="nv">t2</span> : term, <span class="nb">cbv</span> t1 t2 -&gt; ~ is_value t1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> <span class="mi">1</span>; is_value.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span> values_do_not_reduce : is_value obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Extern</span> <span class="mi">1</span> (<span class="kt">False</span>) =&gt; (<span class="nb">eapply</span> values_do_not_reduce) : is_value obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk29"><span class="kn">Lemma</span> <span class="nf">is_value_irred</span>:
  <span class="kr">forall</span> <span class="nv">v</span>,
  is_value v -&gt;
  irred <span class="nb">cbv</span> v.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v</span> : term, is_value v -&gt; irred <span class="nb">cbv</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v</span> : term, is_value v -&gt; irred <span class="nb">cbv</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2b"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> v</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2c"><span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">~ <span class="nb">cbv</span> v b</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span> is_value_irred : irred obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Under every strategy, the property of being a value is preserved by</span>
<span class="c">   reduction. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2d"><span class="kn">Lemma</span> <span class="nf">values_are_stable</span>:
  <span class="kr">forall</span> <span class="nv">mask</span> <span class="nv">v1</span> <span class="nv">v2</span>,
  <span class="nb">red</span> mask v1 v2 -&gt;
  is_value v1 -&gt;
  is_value v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">mask</span> : mask) (<span class="nv">v1</span> <span class="nv">v2</span> : term),
<span class="nb">red</span> mask v1 v2 -&gt; is_value v1 -&gt; is_value v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">mask</span> : mask) (<span class="nv">v1</span> <span class="nv">v2</span> : term),
<span class="nb">red</span> mask v1 v2 -&gt; is_value v1 -&gt; is_value v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; is_value.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk2f"><span class="kn">Lemma</span> <span class="nf">nonvalues_are_stable</span>:
  <span class="kr">forall</span> <span class="nv">mask</span> <span class="nv">v1</span> <span class="nv">v2</span>,
  <span class="nb">red</span> mask v1 v2 -&gt;
  ~ is_value v2 -&gt;
  ~ is_value v1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">mask</span> : mask) (<span class="nv">v1</span> <span class="nv">v2</span> : term),
<span class="nb">red</span> mask v1 v2 -&gt; ~ is_value v2 -&gt; ~ is_value v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk30"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">mask</span> : mask) (<span class="nv">v1</span> <span class="nv">v2</span> : term),
<span class="nb">red</span> mask v1 v2 -&gt; ~ is_value v2 -&gt; ~ is_value v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; is_value.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span> values_are_stable nonvalues_are_stable : is_value obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* [cbv] is deterministic. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk31"><span class="kn">Lemma</span> <span class="nf">cbv_deterministic</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">t1</span>,
  <span class="nb">cbv</span> t t1 -&gt;
  <span class="kr">forall</span> <span class="nv">t2</span>,
  <span class="nb">cbv</span> t t2 -&gt;
  t1 = t2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">t1</span> : term,
<span class="nb">cbv</span> t t1 -&gt; <span class="kr">forall</span> <span class="nv">t2</span> : term, <span class="nb">cbv</span> t t2 -&gt; t1 = t2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk32"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">t1</span> : term,
<span class="nb">cbv</span> t t1 -&gt; <span class="kr">forall</span> <span class="nv">t2</span> : term, <span class="nb">cbv</span> t t2 -&gt; t1 = t2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* Induction over [cbv t t1]. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; <span class="kp">try</span> <span class="kp">solve</span> [ <span class="bp">tauto</span> ]; <span class="nb">intros</span>; <span class="nb">subst</span>;
  <span class="c">(* Invert the second hypothesis, [cbv t t2]. The fact that values do not</span>
<span class="c">     reduce is used to eliminate some cases. *)</span>
  invert_cbv;
  <span class="c">(* The result follows. *)</span>
  <span class="nb">f_equal</span>; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Inversion lemmas for [irred]. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk33"><span class="kn">Lemma</span> <span class="nf">invert_irred_cbv_App_1</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
  irred <span class="nb">cbv</span> (App t u) -&gt;
  irred <span class="nb">cbv</span> t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span> : term, irred <span class="nb">cbv</span> (App t u) -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk34"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span> : term, irred <span class="nb">cbv</span> (App t u) -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk35"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t, u</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t u)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eapply</span> irred_irred; obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk36"><span class="kn">Lemma</span> <span class="nf">invert_irred_cbv_App_2</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
  irred <span class="nb">cbv</span> (App t u) -&gt;
  is_value t -&gt;
  irred <span class="nb">cbv</span> u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span> : term,
irred <span class="nb">cbv</span> (App t u) -&gt; is_value t -&gt; irred <span class="nb">cbv</span> u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk37"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span> : term,
irred <span class="nb">cbv</span> (App t u) -&gt; is_value t -&gt; irred <span class="nb">cbv</span> u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk38"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t, u</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t u)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> u</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eapply</span> irred_irred; obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk39"><span class="kn">Lemma</span> <span class="nf">invert_irred_cbv_App_3</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
  irred <span class="nb">cbv</span> (App t u) -&gt;
  is_value t -&gt;
  is_value u -&gt;
  <span class="kr">forall</span> <span class="nv">t&#39;</span>, t &lt;&gt; Lam t&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span> : term,
irred <span class="nb">cbv</span> (App t u) -&gt;
is_value t -&gt;
is_value u -&gt; <span class="kr">forall</span> <span class="nv">t&#39;</span> : {bind term}, t &lt;&gt; Lam t&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span> : term,
irred <span class="nb">cbv</span> (App t u) -&gt;
is_value t -&gt;
is_value u -&gt; <span class="kr">forall</span> <span class="nv">t&#39;</span> : {bind term}, t &lt;&gt; Lam t&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3b"><span class="nb">intros</span> ? ? Hirred.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t, u</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t u)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">is_value t -&gt;
is_value u -&gt; <span class="kr">forall</span> <span class="nv">t&#39;</span> : {bind term}, t &lt;&gt; Lam t&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3c"><span class="kp">repeat</span> <span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t, u</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value u</span></span></span><br><span><var>t'</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>t = Lam t&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3d"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>u</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t'</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t&#39;)</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App (Lam t&#39;) u)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value u</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3e"><span class="nb">eapply</span> Hirred.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>u</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t'</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t&#39;)</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App (Lam t&#39;) u)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value u</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbv</span> (App (Lam t&#39;) u) <span class="nl">?b</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk3f"><span class="kn">Lemma</span> <span class="nf">invert_irred_cbv_Let_1</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
  irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) -&gt;
  irred <span class="nb">cbv</span> t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">t</span> : term) (<span class="nv">u</span> : {bind term}),
irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk40"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">t</span> : term) (<span class="nv">u</span> : {bind term}),
irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk41"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eapply</span> irred_irred; obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk42"><span class="kn">Lemma</span> <span class="nf">invert_irred_cbv_Let_2</span>:
  <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
  irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) -&gt;
  ~ is_value t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">t</span> : term) (<span class="nv">u</span> : {bind term}),
irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) -&gt; ~ is_value t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk43"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">t</span> : term) (<span class="nv">u</span> : {bind term}),
irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) -&gt; ~ is_value t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk44"><span class="nb">intros</span> ? ? Hirred ?.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk45"><span class="nb">eapply</span> Hirred.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>) <span class="nl">?b</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span>
  invert_irred_cbv_App_1
  invert_irred_cbv_App_2
  invert_irred_cbv_Let_1
  invert_irred_cbv_Let_2
: irred.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* An analysis of irreducible terms for call-by-value reduction. A stuck</span>
<span class="c">   term is either an application [v1 v2] where [v1] is not a function or</span>
<span class="c">   a stuck term in an evaluation context. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">stuck</span> : term -&gt; <span class="kt">Prop</span> :=
| StuckApp:
    <span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span>,
    is_value v1 -&gt;
    is_value v2 -&gt;
    (<span class="kr">forall</span> <span class="nv">t</span>, v1 &lt;&gt; Lam t) -&gt;
    stuck (App v1 v2)
| StuckAppL:
    <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
    stuck t -&gt;
    stuck (App t u)
| StuckAppR:
    <span class="kr">forall</span> <span class="nv">v</span> <span class="nv">u</span>,
    is_value v -&gt;
    stuck u -&gt;
    stuck (App v u)
| StuckLetL:
    <span class="kr">forall</span> <span class="nv">t</span> <span class="nv">u</span>,
    stuck t -&gt;
    stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">u</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Constructors</span> stuck : stuck.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* To go wrong is to reduce to a stuck term. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">goes_wrong</span> <span class="nv">t</span> :=
  <span class="kr">exists</span> <span class="nv">t&#39;</span>, star <span class="nb">cbv</span> t t&#39; /\ stuck t&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* A stuck term cannot be a value. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk46"><span class="kn">Lemma</span> <span class="nf">stuck_nonvalue</span>:
  <span class="kr">forall</span> <span class="nv">t</span>,
  stuck t -&gt;
  ~ is_value t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, stuck t -&gt; ~ is_value t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk47"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, stuck t -&gt; ~ is_value t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">induction</span> <span class="mi">1</span>; is_value.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Every stuck term is irreducible. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">prove_irred_cbv</span> :=
  <span class="kp">do</span> <span class="mi">2</span> <span class="nb">intro</span>; invert_cbv.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk48"><span class="kn">Lemma</span> <span class="nf">stuck_irred</span>:
  <span class="kr">forall</span> <span class="nv">t</span>,
  stuck t -&gt;
  irred <span class="nb">cbv</span> t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, stuck t -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk49"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, stuck t -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk4a"><span class="nb">induction</span> <span class="mi">1</span>; prove_irred_cbv; <span class="kp">try</span> <span class="kp">solve</span> [
    <span class="nb">eauto using</span> irreducible_terms_do_not_reduce
  | <span class="nb">eapply</span> stuck_nonvalue; obvious
  ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v2, t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t0</span> : {bind term}, Lam t &lt;&gt; Lam t0</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>cbv_mask RuleBetaV</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* StuckApp *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk4b">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v2, t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t0</span> : {bind term}, Lam t &lt;&gt; Lam t0</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>cbv_mask RuleBetaV</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">congruence</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Global</span> <span class="kn">Hint Resolve</span> stuck_irred : irred obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Every irreducible term either is a value or is stuck. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk4c"><span class="kn">Lemma</span> <span class="nf">irred_cbv_is_value_or_stuck</span>:
  <span class="kr">forall</span> <span class="nv">t</span>,
  irred <span class="nb">cbv</span> t -&gt;
  is_value t \/ stuck t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk4d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk4e"><span class="nb">induction</span> t; <span class="nb">intro</span> Hirred;
  <span class="kp">try</span> <span class="kp">solve</span> [ is_value ]; <span class="nb">right</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk4f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk4f"><hr></label><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* App *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk50">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk51"><span class="nb">assert</span> (H1: irred <span class="nb">cbv</span> t1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t1</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk52" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk52"><hr></label><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk53">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t1</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto with</span> irred.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk54">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk55"><span class="nb">destruct</span> (IHt1 H1); [| <span class="nb">eauto with</span> stuck ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk56"><span class="nb">assert</span> (H2: irred <span class="nb">cbv</span> t2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk57" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk57"><hr></label><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk58">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto with</span> irred.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk59">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk5a"><span class="nb">destruct</span> (IHt2 H2); [| <span class="nb">eauto with</span> stuck ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1 -&gt; is_value t1 \/ stuck t1</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (App t1 t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t1</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (App t1 t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eapply</span> StuckApp; <span class="nb">eauto using</span> invert_irred_cbv_App_3.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk5b">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* Let *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk5c">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk5d"><span class="nb">assert</span> (H: irred <span class="nb">cbv</span> t).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk5e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk5e"><hr></label><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk5f" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk5f">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto with</span> irred.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk60">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk61"><span class="nb">destruct</span> (IHt H); [| <span class="nb">eauto with</span> stuck ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk62"><span class="nb">assert</span> (~ is_value t).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">~ is_value t</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk63" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>~ is_value t</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk63"><hr></label><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk64">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">~ is_value t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto with</span> irred.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk65">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</span></span></span><br><span><var>IHt0</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t2 -&gt; is_value t2 \/ stuck t2</span></span></span><br><span><var>Hirred</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>irred <span class="nb">cbv</span> t</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>~ is_value t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stuck (<span class="kn">Let</span> <span class="nf">t</span> <span class="nv">t2</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">tauto</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The converse is true as well. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk66"><span class="kn">Lemma</span> <span class="nf">irred_cbv_characterization</span>:
  <span class="kr">forall</span> <span class="nv">t</span>,
  irred <span class="nb">cbv</span> t &lt;-&gt;
  is_value t \/ stuck t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, irred <span class="nb">cbv</span> t &lt;-&gt; is_value t \/ stuck t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk67"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, irred <span class="nb">cbv</span> t &lt;-&gt; is_value t \/ stuck t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk68"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk69" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk69"><hr></label><div class="goal-conclusion">is_value t \/ stuck t -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6a">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">irred <span class="nb">cbv</span> t -&gt; is_value t \/ stuck t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto using</span> irred_cbv_is_value_or_stuck.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6b">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">is_value t \/ stuck t -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6c">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">is_value t \/ stuck t -&gt; irred <span class="nb">cbv</span> t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intuition</span> <span class="nb">eauto with</span> irred.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* A closed value must be a lambda-abstraction. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6d"><span class="kn">Lemma</span> <span class="nf">closed_value</span>:
  <span class="kr">forall</span> <span class="nv">v</span>,
  is_value v -&gt;
  closed v -&gt;
  <span class="kr">exists</span> <span class="nv">t</span>, v = Lam t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v</span> : term,
is_value v -&gt;
closed v -&gt; <span class="kr">exists</span> <span class="nv">t</span> : {bind term}, v = Lam t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v</span> : term,
is_value v -&gt;
closed v -&gt; <span class="kr">exists</span> <span class="nv">t</span> : {bind term}, v = Lam t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk6f"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t</span> : {bind term}, v = Lam t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk70" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk70"><span class="nb">destruct</span> v <span class="kr">as</span> [| t | | ]; <span class="kp">try</span> <span class="kp">solve</span> [ false; is_value ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>var</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Var x)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Var x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t</span> : {bind term}, Var x = Lam t</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk71" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Lam t)</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk71"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t0</span> : {bind term}, Lam t = Lam t0</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk72">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>var</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Var x)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Var x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t</span> : {bind term}, Var x = Lam t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk73" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk73">false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>var</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Var x)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Var x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk74" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk74"><span class="nb">eapply</span> closed_Var.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>var</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Var x)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Var x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">closed (Var <span class="nl">?x</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk75" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk75">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Lam t)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t0</span> : {bind term}, Lam t = Lam t0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk76">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Lam t)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t0</span> : {bind term}, Lam t = Lam t0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk77"><span class="kr">exists</span> <span class="nv">t</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam t)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>closed (Lam t)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Lam t = Lam t</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* A stuck term cannot be closed. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk78"><span class="kn">Lemma</span> <span class="nf">stuck_closed</span>:
  <span class="kr">forall</span> <span class="nv">t</span>,
  stuck t -&gt;
  closed t -&gt;
  <span class="kt">False</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, stuck t -&gt; closed t -&gt; <span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk79"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term, stuck t -&gt; closed t -&gt; <span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk7a"><span class="nb">induction</span> <span class="mi">1</span>; <span class="nb">intros</span>; <span class="nb">eauto with</span> closed.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* StuckApp *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk7b">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk7c"><span class="nb">assert</span> (ht1: <span class="kr">exists</span> <span class="nv">t1</span>, v1 = Lam t1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t1</span> : {bind term}, v1 = Lam t1</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk7d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br><span><var>ht1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">t1</span> : {bind term}, v1 = Lam t1</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk7d"><hr></label><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk7e" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk7e">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">t1</span> : {bind term}, v1 = Lam t1</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto using</span> closed_value <span class="kr">with</span> closed.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk7f" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk7f">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br><span><var>ht1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">t1</span> : {bind term}, v1 = Lam t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk80" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk80"><span class="nb">destruct</span> ht1 <span class="kr">as</span> (?&amp;?).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value v1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, v1 &lt;&gt; Lam t</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App v1 v2)</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>v1 = Lam x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk81" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk81"><span class="nb">subst</span> v1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>v2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_value (Lam x)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value v2</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>closed (App (Lam x) v2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">t</span> : {bind term}, Lam x &lt;&gt; Lam t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">congruence</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Under call-by-value, every closed term either reduces or is a value. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk82" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk82"><span class="kn">Lemma</span> <span class="nf">cbv_progress</span>:
  <span class="kr">forall</span> <span class="nv">t</span>,
  closed t -&gt;
  is_value t \/ <span class="kr">exists</span> <span class="nv">u</span>, <span class="nb">cbv</span> t u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term,
closed t -&gt; is_value t \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk83"><span class="kn">Local Ltac</span> <span class="nf">ih</span> IH :=
  <span class="nb">destruct</span> IH <span class="kr">as</span> [| [ ? ? ]]; [ <span class="nb">eauto with</span> closed | | obvious ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term,
closed t -&gt; is_value t \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk84"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">t</span> : term,
closed t -&gt; is_value t \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t u)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* We give a direct proof, but the result also follows from</span>
<span class="c">     [irred_cbv_is_value_or_stuck] and [stuck_closed]. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk85"><span class="nb">induction</span> t <span class="kr">as</span> [| | t1 IHt1 t2 IHt2 | t1 IHt1 t2 IHt2 ];
  <span class="kp">try</span> <span class="kp">solve</span> [ <span class="nb">left</span>; obvious ]; <span class="nb">right</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>closed t1 -&gt;
is_value t1 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t1 u)</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (App t1 t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (App t1 t2) u</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="lambdacalculusreduction-v-chk86" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>closed t1 -&gt;
is_value t1 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t1 u)</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>)</span></span></span><br></div><label class="goal-separator" for="lambdacalculusreduction-v-chk86"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>) u</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* App *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk87">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>closed t1 -&gt;
is_value t1 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t1 u)</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (App t1 t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (App t1 t2) u</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk88">ih IHt1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (App t1 t2)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (App t1 t2) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk89">ih IHt2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (App t1 t2)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>is_value t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (App t1 t2) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk8a"><span class="nb">destruct</span> (closed_value t1) <span class="kr">as</span> [ u1 ? ]; <span class="nb">eauto with</span> closed; <span class="nb">subst</span> t1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t2</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>u1</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value (Lam u1)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (App (Lam u1) t2)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>is_value t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (App (Lam u1) t2) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk8b">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>closed t1 -&gt;
is_value t1 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t1 u)</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>) u</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* Let *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk8c">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt1</var><span class="hyp-type"><b>: </b><span>closed t1 -&gt;
is_value t1 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t1 u)</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>) u</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="lambdacalculusreduction-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="lambdacalculusreduction-v-chk8d">ih IHt1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>t1</var><span class="hyp-type"><b>: </b><span>term</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>{bind term}</span></span></span><br><span><var>IHt2</var><span class="hyp-type"><b>: </b><span>closed t2 -&gt;
is_value t2 \/ (<span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> t2 u)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>closed (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>is_value t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">u</span> : term, <span class="nb">cbv</span> (<span class="kn">Let</span> <span class="nf">t1</span> <span class="nv">t2</span>) u</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">obvious.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">}</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre>
</div>
</div></body>
</html>
